<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LeadX Ambassador Widget Demo</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }
      .demo-content {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      p {
        color: #666;
        line-height: 1.6;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div class="demo-content">
      <h1>LeadX Ambassador Widget Demo</h1>
      <p>
        This page shows ambassador cards directly on the page. The cards will
        load automatically when the page loads.
      </p>
    </div>

    <!-- Ambassador Cards Container -->
    <div
      id="ambassadors-main-container"
      style="max-width: 1200px; margin: 20px auto; padding: 0 20px"
    >
      <div style="text-align: center; padding: 60px 30px">
        <div class="leadx-spinner"></div>
        <p style="margin: 0; color: #666">Loading ambassadors...</p>
      </div>
    </div>

    <!-- LeadX Ambassador Widget Script -->
    <script>
      // Test with a sample configId - replace with actual configId from your customization
      const testConfigId = "config_1759736379107_umkwtmdrr"

      // Load the widget script dynamically
      const script = document.createElement("script")
      script.src = `http://localhost:5000/api/customization/script/${testConfigId}.js`
      script.onload = () => {
        console.log("‚úÖ LeadX Widget script loaded successfully")
      }
      script.onerror = () => {
        console.error("‚ùå Failed to load LeadX Widget script")
        // Fallback: Load widget directly with inline script
        loadWidgetDirectly()
      }
      document.head.appendChild(script)

      // Fallback function to load widget directly
      function loadWidgetDirectly() {
        console.log("üîÑ Loading widget directly...")

        // Direct widget implementation - Show cards on page directly
        ;(function () {
          console.log("üöÄ LeadX Ambassador Widget Loading (Direct Mode)...")

          const CONFIG = {
            apiUrl: "http://localhost:5000",
            colors: {
              button: "#6366f1",
              text: "#ffffff",
              border: "#e5e7eb",
              borderSize: "1",
            },
          }

          // Add CSS styles
          const styles = `
                    <style id="leadx-ambassador-styles">
                        .leadx-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                            gap: 24px;
                            padding: 30px;
                        }
                        .leadx-ambassador-card {
                            background: white;
                            border-radius: 12px;
                            border: 2px solid ${CONFIG.colors.border};
                            transition: all 0.5s ease;
                            overflow: hidden;
                            width: 100%;
                            max-width: 320px;
                            height: 450px;
                            display: flex;
                            flex-direction: column;
                            position: relative;
                            margin: 0 auto;
                        }
                        .leadx-ambassador-card:hover {
                            border-color: #3b82f6;
                            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                            transform: translateY(-2px);
                        }
                        .leadx-chat-btn {
                            background: ${CONFIG.colors.button};
                            color: ${CONFIG.colors.text};
                            border: none;
                            border-radius: 8px;
                            padding: 10px 20px;
                            font-size: 14px;
                            font-weight: 500;
                            cursor: pointer;
                            width: 100%;
                            transition: all 0.3s ease;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            gap: 8px;
                        }
                        .leadx-chat-btn:hover {
                            opacity: 0.9;
                            transform: scale(1.05);
                        }
                        @keyframes leadx-spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                        .leadx-spinner {
                            width: 40px;
                            height: 40px;
                            border: 3px solid #ddd;
                            border-top: 3px solid #007bff;
                            border-radius: 50%;
                            animation: leadx-spin 1s linear infinite;
                            margin: 0 auto 20px;
                        }
                        @media (max-width: 768px) {
                            .leadx-grid {
                                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                                gap: 20px;
                                padding: 20px;
                            }
                            .leadx-ambassador-card {
                                height: 400px;
                            }
                        }
                    </style>
                `

          if (!document.getElementById("leadx-ambassador-styles")) {
            document.head.insertAdjacentHTML("beforeend", styles)
          }

          // Load ambassadors directly on page load
          async function loadAmbassadors() {
            try {
              console.log("üì° Loading ambassadors...")
              const response = await fetch(
                `${CONFIG.apiUrl}/api/auth/ambassadors/public`
              )
              const result = await response.json()

              console.log("API Response:", result)

              if (result.success && result.data) {
                const ambassadors = result.data
                console.log(`‚úÖ Loaded ${ambassadors.length} ambassadors`)
                console.log("Ambassadors data:", ambassadors)
                renderAmbassadorCards(ambassadors)
              } else {
                throw new Error(result.message || "No ambassadors found")
              }
            } catch (error) {
              console.error("‚ùå Error loading ambassadors:", error)
              document.getElementById(
                "ambassadors-main-container"
              ).innerHTML = `
                            <div style="text-align: center; padding: 60px 30px; color: #666;">
                                <p>Unable to load ambassadors. Please try again later.</p>
                                <p style="font-size: 12px; margin-top: 10px;">Error: ${error.message}</p>
                                <p style="font-size: 12px; margin-top: 10px;">Make sure your backend server is running on http://localhost:5000</p>
                            </div>
                        `
            }
          }

          // Render ambassador cards directly on the page
          function renderAmbassadorCards(ambassadors) {
            const container = document.getElementById(
              "ambassadors-main-container"
            )

            if (!ambassadors.length) {
              container.innerHTML = `
                            <div style="text-align: center; padding: 60px 30px; color: #666;">
                                <p>No ambassadors available at the moment.</p>
                                <p style="font-size: 12px; margin-top: 10px;">Make sure you have ambassadors with role='ambassador', isVerified=true, and status='active' in your database.</p>
                            </div>
                        `
              return
            }

            const cards = ambassadors
              .map(
                (ambassador) => `
                        <div class="leadx-ambassador-card">
                            <div style="
                                position: relative;
                                height: 80px;
                                width: 100%;
                                background: ${CONFIG.colors.button};
                                background-image: url('${
                                  ambassador.thumbnailImage
                                    ? CONFIG.apiUrl +
                                      "/" +
                                      ambassador.thumbnailImage
                                    : ""
                                }');
                                background-size: cover;
                                background-position: center;
                            ">
                                <div style="
                                    position: absolute;
                                    inset: 0;
                                    background: linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 100%);
                                "></div>
                                
                                <div style="
                                    position: absolute;
                                    bottom: -30px;
                                    left: 50%;
                                    transform: translateX(-50%);
                                    width: 72px;
                                    height: 72px;
                                    border-radius: 50%;
                                    border: 4px solid white;
                                    overflow: hidden;
                                    background: white;
                                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                                ">
                                    <img 
                                        src="${
                                          ambassador.profileImage
                                            ? CONFIG.apiUrl +
                                              "/" +
                                              ambassador.profileImage
                                            : "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzIiIGhlaWdodD0iNzIiIHZpZXdCb3g9IjAgMCA3MiA3MiIgZmlsbD0ibm9uZSI+PGNpcmNsZSBjeD0iMzYiIGN5PSIzNiIgcj0iMzYiIGZpbGw9IiNlNWU3ZWIiLz48cGF0aCBkPSJNMzYgMzhjMy45IDAgNy0zLjEgNy03cy0zLjEtNy03LTctNyAzLjEtNyA3IDMuMSA3IDcgN3ptMCAyYy00LjcgMC0xNCAyLjMtMTQgN3YyaDI4di0yYzAtNC43LTkuMy03LTE0LTd6IiBmaWxsPSIjOWZhNmIyIi8+PC9zdmc+"
                                        }"
                                        alt="${ambassador.name}"
                                        style="width: 100%; height: 100%; object-fit: cover;"
                                        onerror="console.log('Image failed to load:', this.src)"
                                    />
                                </div>
                                
                                <div style="
                                    position: absolute;
                                    bottom: -25px;
                                    left: 50%;
                                    transform: translateX(20px);
                                    width: 16px;
                                    height: 16px;
                                    background: #10b981;
                                    border: 3px solid white;
                                    border-radius: 50%;
                                ">
                                    <div style="
                                        width: 6px;
                                        height: 6px;
                                        background: #059669;
                                        border-radius: 50%;
                                        margin: 2px auto;
                                    "></div>
                                </div>
                            </div>
                            
                            <div style="
                                padding: 40px 16px 16px;
                                flex: 1;
                                display: flex;
                                flex-direction: column;
                            ">
                                <h3 style="
                                    margin: 0 0 8px 0;
                                    text-align: center;
                                    font-size: 16px;
                                    font-weight: 600;
                                    color: #1f2937;
                                ">
                                    ${ambassador.name}
                                </h3>
                                
                                <div style="
                                    background: rgba(255,255,255,0.3);
                                    backdrop-filter: blur(4px);
                                    border-radius: 8px;
                                    padding: 8px 12px;
                                    border: 1px solid rgba(203, 213, 225, 0.3);
                                    margin-bottom: 12px;
                                    text-align: center;
                                ">
                                    <p style="
                                        margin: 0;
                                        font-size: 12px;
                                        font-weight: 600;
                                        color: #1f2937;
                                    ">
                                        ${
                                          ambassador.course ||
                                          ambassador.program ||
                                          "BBA"
                                        }
                                    </p>
                                </div>
                                
                                <div style="
                                    background: rgba(255,255,255,0.3);
                                    backdrop-filter: blur(4px);
                                    border-radius: 8px;
                                    padding: 8px 12px;
                                    border: 1px solid rgba(203, 213, 225, 0.3);
                                    margin-bottom: 12px;
                                    text-align: center;
                                ">
                                    <p style="
                                        margin: 0 0 4px 0;
                                        font-size: 12px;
                                        font-weight: 600;
                                        color: #1f2937;
                                    ">
                                        I'm from
                                    </p>
                                    <div style="display: flex; align-items: center; justify-content: center; gap: 4px;">
                                        <img
                                            src="https://flagcdn.com/24x18/${
                                              ambassador.country === "India" ||
                                              !ambassador.country
                                                ? "in"
                                                : "us"
                                            }.png"
                                            alt="Flag"
                                            style="width: 16px; height: 12px; border-radius: 2px;"
                                            onerror="this.style.display='none'"
                                        />
                                        <p style="
                                            margin: 0;
                                            font-size: 12px;
                                            font-weight: 400;
                                            color: #374151;
                                        ">
                                            ${
                                              ambassador.state ||
                                              ambassador.country ||
                                              "India"
                                            }
                                        </p>
                                    </div>
                                </div>
                                
                                <div style="
                                    background: rgba(255,255,255,0.3);
                                    backdrop-filter: blur(4px);
                                    border-radius: 8px;
                                    padding: 8px 12px;
                                    border: 1px solid rgba(203, 213, 225, 0.3);
                                    margin-bottom: 12px;
                                    text-align: center;
                                ">
                                    <p style="
                                        margin: 0 0 4px 0;
                                        font-size: 12px;
                                        font-weight: 600;
                                        color: #1f2937;
                                    ">
                                        I Speak
                                    </p>
                                    <p style="
                                        margin: 0;
                                        font-size: 12px;
                                        font-weight: 400;
                                        color: #374151;
                                    ">
                                        ${
                                          Array.isArray(ambassador.languages)
                                            ? ambassador.languages.join(" | ")
                                            : ambassador.languages || "English"
                                        }
                                    </p>
                                </div>
                                
                                <div style="
                                    background: rgba(255,255,255,0.3);
                                    backdrop-filter: blur(4px);
                                    border-radius: 8px;
                                    padding: 8px 12px;
                                    border: 1px solid rgba(203, 213, 225, 0.3);
                                    margin-bottom: 16px;
                                    text-align: center;
                                    flex: 1;
                                ">
                                    <p style="
                                        margin: 0 0 4px 0;
                                        font-size: 12px;
                                        font-weight: 600;
                                        color: #1f2937;
                                    ">
                                        About me
                                    </p>
                                    <p style="
                                        margin: 0;
                                        font-size: 11px;
                                        color: #6b7280;
                                        line-height: 1.4;
                                        font-weight: 400;
                                    ">
                                        ${
                                          (
                                            ambassador.description ||
                                            ambassador.about ||
                                            "Student Ambassador ready to help!"
                                          ).length > 80
                                            ? (
                                                ambassador.description ||
                                                ambassador.about ||
                                                "Student Ambassador ready to help!"
                                              ).substring(0, 80) + "..."
                                            : ambassador.description ||
                                              ambassador.about ||
                                              "Student Ambassador ready to help!"
                                        }
                                    </p>
                                </div>
                                
                                <div style="margin-top: auto;">
                                    <button 
                                        class="leadx-chat-btn"
                                        onclick="startChat('${
                                          ambassador._id
                                        }', '${ambassador.name}')"
                                    >
                                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                                        </svg>
                                        Chat
                                    </button>
                                </div>
                            </div>
                        </div>
                    `
              )
              .join("")

            container.innerHTML = `
                        <div class="leadx-grid">
                            ${cards}
                        </div>
                    `
          }

          // Start chat function
          window.startChat = function (ambassadorId, ambassadorName) {
            alert(`Starting chat with ${ambassadorName} (ID: ${ambassadorId})`)
          }

          // Initialize and load ambassadors immediately
          loadAmbassadors()
          console.log("‚úÖ LeadX Ambassador Widget initialized (Direct Mode)!")
        })()
      }
    </script>
  </body>
</html>
